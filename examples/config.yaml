# ABOUTME: Main configuration file for hikmaai-argus
# ABOUTME: Copy to ~/.config/hikmaai-argus/config.yaml or /etc/hikmaai-argus/config.yaml

# HikmaAV runs as a standalone single binary by default.
# All external dependencies (NATS, HTTP server, tracing) are DISABLED by default.
# Uncomment the sections below to enable them.

# Data directory for HikmaAI signatures (BadgerDB, bloom filter, job store, scan cache)
data_dir: data/hikmaaidb

# ClamAV database directory for CVD files (main.cvd, daily.cvd)
# Managed by the "clamav-db" feed source or hikmaai-argus feeds update --source clamav-db
clamdb_dir: data/clamdb

# NATS configuration for daemon mode (OPTIONAL)
# Uncomment to enable NATS messaging
# nats:
#   url: nats://localhost:4222
#   subject: hikma.av.scan
#   queue: av-workers

# HTTP server for health/metrics endpoints (OPTIONAL)
# Uncomment to enable HTTP endpoints
# http:
#   addr: :8080

# Logging configuration
log:
  level: info    # debug, info, warn, error
  format: text   # text (human-readable) or json (for Loki)

# OpenTelemetry tracing (OPTIONAL, Tempo compatible)
# Disabled by default for standalone operation
tracing:
  enabled: false
  # endpoint: localhost:4317
  # insecure: true
  # sampling_ratio: 1.0  # 1.0 = sample all, 0.1 = 10%

# Signature feed configuration
# Note: Feeds can also be managed via daemon flags:
#   hikmaai-argus daemon --feeds-update --feeds-interval 1h
feeds:
  update_interval: 1h
  sources:
    - eicar           # Built-in EICAR test signatures
    # - clamav        # ClamAV signature hashes (extracts from CVD files to DB)
    # - clamav-db     # Downloads CVD files for clamscan (required for file scanning)
    # - malwarebazaar # abuse.ch MalwareBazaar hashes
    # - threatfox     # abuse.ch ThreatFox IOCs

# ClamAV scanner configuration (OPTIONAL)
# Provides full file analysis in addition to hash lookups.
# Disabled by default; requires ClamAV to be installed.
clamav:
  enabled: false

  # Scanner mode: "clamscan" (default) or "clamd"
  # clamscan: Uses the clamscan binary (slower, loads DB per scan)
  # clamd: Connects to clamd daemon (faster, keeps DB in memory)
  mode: clamscan

  # Path to clamscan binary (only for clamscan mode)
  binary: clamscan

  # Database directory for CVD files (main.cvd, daily.cvd, bytecode.cvd)
  # Managed by the "clamav-db" feed source
  # Defaults to clamdb_dir (data/clamdb) if not set
  # database_dir: data/clamdb

  # clamd address (only for clamd mode)
  # address: unix:///var/run/clamav/clamd.ctl
  # address: tcp://localhost:3310

  # Scan timeout
  timeout: 5m

  # Maximum file size to scan (100MB default)
  max_file_size: 104857600

  # Number of concurrent scan workers
  workers: 2

  # Cache TTL for scan results (avoids re-scanning same file)
  cache_ttl: 24h

# Trivy dependency vulnerability scanner (OPTIONAL)
# Scans package dependencies for known CVEs via a remote Trivy server.
# Only package names and versions are sent; no source code or file contents.
# Disabled by default; requires a running Trivy server.
trivy:
  enabled: false

  # Trivy server URL (required to enable)
  # Start a Trivy server: docker run -p 4954:4954 aquasec/trivy server --listen 0.0.0.0:4954
  # server_url: http://trivy-server:4954

  # Scan timeout
  timeout: 2m

  # Default severity filter (if not specified in request)
  # Only vulnerabilities matching these severities will be returned
  default_severities:
    - HIGH
    - CRITICAL

  # Supported package ecosystems
  supported_ecosystems:
    - pip       # Python packages
    - npm       # Node.js packages
    - gomod     # Go modules
    - cargo     # Rust crates
    - composer  # PHP packages
    # - maven   # Java packages
    # - nuget   # .NET packages
    # - rubygems # Ruby gems

  # Number of concurrent scan workers
  workers: 2

  # Cache TTL for per-package vulnerability results
  # Caching reduces redundant queries to Trivy server
  cache_ttl: 1h

# Redis configuration for AS3 integration (OPTIONAL)
# Required for Argus worker mode to receive tasks from AS3.
# Disabled by default.
redis:
  enabled: false
  addr: localhost:6379
  # password: ""
  db: 0

  # Key prefix for multi-tenant isolation
  # All keys will be prefixed: argus:job_state:123, argus:task_queue, etc.
  prefix: "argus:"

  pool_size: 10
  read_timeout: 5s
  write_timeout: 5s

# GCS configuration for skill artifact storage (OPTIONAL)
# Required for Argus worker mode to download skill archives from AS3.
# Disabled by default.
gcs:
  enabled: false
  # GCS bucket name for skill archives
  # bucket: hikma-skills

  # GCP project ID (optional if using ADC)
  # project_id: hikmaai-prod

  # Service account credentials file (optional, uses ADC if empty)
  # credentials_file: /path/to/service-account.json

  # Local directory for downloaded files
  download_dir: /tmp/argus/downloads

# Argus worker configuration for AS3 integration (OPTIONAL)
# Processes scan tasks from AS3 via Redis Streams.
# Disabled by default; requires Redis and GCS to be configured.
argus_worker:
  enabled: false

  # Redis stream name for incoming tasks
  task_queue: argus_task_queue

  # Consumer group name for horizontal scaling
  consumer_group: argus-workers

  # Consumer name (auto-generated from hostname if empty)
  # consumer_name: argus-1

  # Prefix for completion signal streams
  completion_prefix: argus_completion

  # Number of concurrent scan workers
  workers: 2

  # Default timeout for scan operations
  default_timeout: 15m

  # Maximum retries before giving up on a task
  max_retries: 3

  # Remove temp files after scan completes
  cleanup_on_complete: true

  # TTL for job state entries (7 days default)
  state_ttl: 168h
